<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>
用户名:
<input id="username" type="text"/>
密码:
<input id="password" type="text"/>
<img src="" id="img"/>
<button type="button" id="btn_code">刷新验证码</button>
验证码:
<input id="code" type="text"/>

<button type="button" id="btn">登录</button>
<button type="button" id="btn1">刷新token</button>
<script>
    var host="http://localhost:8842"
    var access_token
    var refresh_token
    $(function (){
        $('#btn').click(function (){
            var username=$('#username').val();
            var password=$('#password').val();
            var code=$('#code').val();
            $.ajax({
                type: 'POST',
                url: host+"/auth/oauth/token",
                data: {username:username,password:password,valid_code:code,grant_type:'password',scope:'operation'},
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(
                        "Authorization",
                        "Basic d2Y6d2Y="
                    );
                },
                success: function (res){
                    if(res.access_token && res.refresh_token){
                        access_token=res.access_token;
                        refresh_token=res.refresh_token;
                    }
                    console.log(res)
                },
                dataType: "json"
            });
        });
        $('#btn_code').click(function (){
            $('#img').attr('src',host+"/auth/anonymous/valid_code?time="+new Date().getTime())
        });
        $('#btn1').click(function (){
            $.ajax({
                type: 'POST',
                url: host+"/oauth/token",
                data: {refresh_token:refresh_token,grant_type:'refresh_token',scope:'operation'},
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(
                        "Authorization",
                        "Basic d2Y6d2Y="
                    );
                },
                success: function (res){
                    if(res.access_token && res.refresh_token){
                        access_token=res.access_token;
                        refresh_token=res.refresh_token;
                    }
                    console.log(res)
                },
                dataType: "json"
            });
        });


    })
</script>

</body>
</html>